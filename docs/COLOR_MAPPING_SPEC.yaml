# Windows Terminal to IntelliJ Color Mapping Specification
# Version: 1.0
# Date: 2025-11-20
# Sprint: 1 (Foundation)

---
metadata:
  version: "1.0"
  last_updated: "2025-11-20"
  status: "DRAFT"
  author: "Automated System"

# ==============================================================================
# CORE MAPPING: Windows Terminal → IntelliJ Console Colors (16 ANSI + 4 Special)
# ==============================================================================

console_color_mappings:
  # Special Colors
  background:
    intellij_attribute: "CONSOLE_BACKGROUND_KEY"
    required: true
    fallback: null
    description: "Terminal background color"

  foreground:
    intellij_attributes:
      - "CONSOLE_NORMAL_OUTPUT"
      - "FOREGROUND"
    required: true
    fallback: null
    description: "Default text color"

  cursorColor:
    intellij_attributes:
      - "CARET_COLOR"
      - "CONSOLE_CURSOR"
    required: false
    fallback: "foreground"
    description: "Cursor color in terminal"

  selectionBackground:
    intellij_attribute: "CONSOLE_SELECTION_BACKGROUND"
    required: false
    fallback_strategy: "blend"
    fallback_params:
      color1: "background"
      color2: "foreground"
      ratio: 0.2
    description: "Selection highlight color"

  # ANSI Colors (Normal)
  black:
    intellij_attribute: "CONSOLE_BLACK_OUTPUT"
    ansi_code: 30
    required: true

  red:
    intellij_attribute: "CONSOLE_RED_OUTPUT"
    ansi_code: 31
    required: true

  green:
    intellij_attribute: "CONSOLE_GREEN_OUTPUT"
    ansi_code: 32
    required: true

  yellow:
    intellij_attribute: "CONSOLE_YELLOW_OUTPUT"
    ansi_code: 33
    required: true

  blue:
    intellij_attribute: "CONSOLE_BLUE_OUTPUT"
    ansi_code: 34
    required: true

  purple:
    intellij_attribute: "CONSOLE_MAGENTA_OUTPUT"
    ansi_code: 35
    required: true
    note: "Windows Terminal 'purple' maps to ANSI magenta"

  cyan:
    intellij_attribute: "CONSOLE_CYAN_OUTPUT"
    ansi_code: 36
    required: true

  white:
    intellij_attribute: "CONSOLE_GRAY_OUTPUT"
    ansi_code: 37
    required: true
    note: "Windows Terminal 'white' maps to ANSI gray"

  # ANSI Colors (Bright)
  brightBlack:
    intellij_attribute: "CONSOLE_DARKGRAY_OUTPUT"
    ansi_code: 90
    required: true

  brightRed:
    intellij_attribute: "CONSOLE_RED_BRIGHT_OUTPUT"
    ansi_code: 91
    required: true

  brightGreen:
    intellij_attribute: "CONSOLE_GREEN_BRIGHT_OUTPUT"
    ansi_code: 92
    required: true

  brightYellow:
    intellij_attribute: "CONSOLE_YELLOW_BRIGHT_OUTPUT"
    ansi_code: 93
    required: true

  brightBlue:
    intellij_attribute: "CONSOLE_BLUE_BRIGHT_OUTPUT"
    ansi_code: 94
    required: true

  brightPurple:
    intellij_attribute: "CONSOLE_MAGENTA_BRIGHT_OUTPUT"
    ansi_code: 95
    required: true

  brightCyan:
    intellij_attribute: "CONSOLE_CYAN_BRIGHT_OUTPUT"
    ansi_code: 96
    required: true

  brightWhite:
    intellij_attribute: "CONSOLE_WHITE_OUTPUT"
    ansi_code: 97
    required: true
    note: "Brightest white for terminal output"

# ==============================================================================
# SYNTAX COLOR INFERENCE: ANSI Colors → Editor Syntax Highlighting
# ==============================================================================

syntax_inference_rules:
  # Rule Priority: EXACT > COLOR_CLASS > SEMANTIC > FALLBACK

  # Comments (typically low-brightness, desaturated)
  COMMENT:
    priority: HIGH
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "brightBlack"  # Most common for comments
      - "white"        # If brightBlack too dark
    luminance_target: "DARK"
    fallback: "foreground"
    apply_dimming: 0.7

  DOC_COMMENT:
    inherit_from: "COMMENT"
    apply_dimming: 0.85

  # Keywords (typically blue/purple)
  KEYWORD:
    priority: HIGH
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "blue"
      - "brightBlue"
      - "purple"
    hue_range: [200, 280]  # Blue to purple spectrum
    fallback: "blue"

  # Strings (typically green)
  STRING_TEXT:
    priority: HIGH
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "green"
      - "brightGreen"
    hue_range: [80, 160]  # Green spectrum
    fallback: "green"

  VALID_STRING_ESCAPE:
    inherit_from: "STRING_TEXT"
    apply_lightening: 0.2

  # Numbers (typically yellow/cyan)
  NUMBER:
    priority: MEDIUM
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "yellow"
      - "brightYellow"
      - "cyan"
    hue_range: [40, 200]
    fallback: "yellow"

  # Functions (typically cyan/blue)
  FUNCTION_CALL:
    priority: MEDIUM
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "cyan"
      - "brightCyan"
      - "blue"
    hue_range: [170, 220]
    fallback: "cyan"

  FUNCTION_DECLARATION:
    inherit_from: "FUNCTION_CALL"
    apply_style: "BOLD"

  # Classes/Types (typically yellow/orange)
  CLASS_NAME:
    priority: MEDIUM
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "yellow"
      - "brightYellow"
    hue_range: [30, 70]
    fallback: "yellow"
    apply_style: "BOLD"

  # Errors (red)
  ERRORS_ATTRIBUTES:
    priority: HIGH
    strategy: "EXACT"
    source: "red"
    fallback: "brightRed"

  WRONG_REFERENCES_ATTRIBUTES:
    priority: HIGH
    strategy: "EXACT"
    source: "red"
    underline: "WAVE"

  # Constants/Enums (purple/magenta)
  CONSTANT:
    priority: MEDIUM
    strategy: "COLOR_CLASS"
    preferred_sources:
      - "purple"
      - "brightPurple"
    hue_range: [280, 330]
    fallback: "purple"

# ==============================================================================
# COLOR CLASSIFICATION SYSTEM
# ==============================================================================

color_classification:
  luminance_thresholds:
    DARK: [0, 100]      # RGB luminance < 100
    MID: [100, 155]     # RGB luminance 100-155
    BRIGHT: [155, 255]  # RGB luminance > 155

  luminance_formula:
    type: "PERCEIVED"
    formula: "0.299 * R + 0.587 * G + 0.114 * B"

  hue_extraction:
    type: "HSV"
    range: [0, 360]  # Degrees

  saturation_thresholds:
    GRAYSCALE: [0, 15]       # < 15% saturation
    DESATURATED: [15, 40]    # 15-40% saturation
    SATURATED: [40, 100]     # > 40% saturation

# ==============================================================================
# EDGE CASE HANDLING
# ==============================================================================

edge_cases:
  monochrome_palette:
    detection:
      method: "LUMINANCE_VARIANCE"
      threshold: 0.05  # 5% variation
      formula: "(max_luminance - min_luminance) / 255"

    handling:
      strategy: "FONT_STYLES"
      fallback_styles:
        KEYWORD: "BOLD"
        STRING: "ITALIC"
        COMMENT: "ITALIC"
        FUNCTION: "BOLD"
        CLASS: "BOLD"
        NUMBER: "REGULAR"
      preserve_luminance: true

  high_contrast:
    detection:
      method: "WCAG_CONTRAST_RATIO"
      threshold: 7.0  # WCAG AAA
      ratio: "(foreground, background)"

    handling:
      strategy: "PRESERVE"
      note: "High contrast is desirable, maintain as-is"

  low_contrast:
    detection:
      method: "WCAG_CONTRAST_RATIO"
      threshold: 3.0  # Below WCAG AA

    handling:
      strategy: "ENHANCE"
      actions:
        - "Darken background by 10%"
        - "Lighten foreground by 10%"
        - "Increase saturation of syntax colors by 15%"
      target_ratio: 4.5  # WCAG AA minimum

  limited_palette:
    detection:
      method: "UNIQUE_HUES"
      threshold: 3  # Less than 3 unique hues

    handling:
      strategy: "LUMINANCE_BASED"
      note: "Use luminance variations to differentiate syntax elements"
      approach:
        - "Assign brightest to keywords"
        - "Assign mid-range to strings"
        - "Assign darkest to comments"

# ==============================================================================
# VALIDATION RULES
# ==============================================================================

validation_rules:
  hex_color_format:
    pattern: "^#[0-9A-Fa-f]{6}$"
    error_message: "Color must be in #RRGGBB format"

  required_properties:
    - name
    - background
    - foreground
    - black
    - red
    - green
    - yellow
    - blue
    - purple
    - cyan
    - white
    - brightBlack
    - brightRed
    - brightGreen
    - brightYellow
    - brightBlue
    - brightPurple
    - brightCyan
    - brightWhite

  optional_properties:
    - cursorColor
    - selectionBackground

  contrast_validation:
    minimum_ratio: 3.0  # WCAG AA for large text
    recommended_ratio: 4.5  # WCAG AA for normal text
    check_pairs:
      - ["foreground", "background"]
      - ["cursorColor", "background"]

  brightness_validation:
    method: "RELATIVE_LUMINANCE"
    warn_if_all_dark: true
    warn_if_all_bright: true
    threshold: 0.8  # Warn if 80%+ colors in same luminance class

# ==============================================================================
# FALLBACK STRATEGIES
# ==============================================================================

fallback_strategies:
  missing_cursor_color:
    strategy: "USE_FOREGROUND"

  missing_selection_background:
    strategy: "BLEND"
    formula: "background * 0.8 + foreground * 0.2"

  invalid_color:
    strategy: "USE_DEFAULT"
    defaults:
      background: "#282c34"
      foreground: "#abb2bf"
      red: "#e06c75"
      green: "#98c379"
      blue: "#61afef"
      yellow: "#e5c07b"

  insufficient_syntax_colors:
    strategy: "INTERPOLATE"
    note: "Generate intermediate colors between available ones"

# ==============================================================================
# TESTING REQUIREMENTS
# ==============================================================================

test_cases:
  valid_schemes:
    - name: "Standard RGB scheme"
      all_colors_present: true
      all_colors_valid_hex: true
      expected_result: "SUCCESS"

  edge_cases:
    - name: "Monochrome scheme"
      variation: "< 5%"
      expected_handling: "FONT_STYLES"

    - name: "High contrast"
      contrast_ratio: "> 7.0"
      expected_handling: "PRESERVE"

    - name: "Low contrast"
      contrast_ratio: "< 3.0"
      expected_handling: "ENHANCE"

    - name: "Missing optional colors"
      missing: ["cursorColor", "selectionBackground"]
      expected_handling: "FALLBACK"

  invalid_schemes:
    - name: "Invalid hex format"
      error: "Color not in #RRGGBB format"

    - name: "Missing required property"
      error: "Missing required property: [name]"

# ==============================================================================
# WCAG CONTRAST CALCULATION
# ==============================================================================

wcag_contrast:
  formula:
    step1: "Convert hex to RGB"
    step2: "Calculate relative luminance for each color"
    step3: "Apply formula: (L1 + 0.05) / (L2 + 0.05)"
    step4: "L1 is lighter color, L2 is darker"

  relative_luminance:
    formula: "0.2126 * R + 0.7152 * G + 0.0722 * B"
    gamma_correction:
      condition: "if value <= 0.03928"
      then: "value / 12.92"
      else: "((value + 0.055) / 1.055) ^ 2.4"

  levels:
    AAA: 7.0
    AA_normal: 4.5
    AA_large: 3.0
    minimum: 3.0

# ==============================================================================
# IMPLEMENTATION NOTES
# ==============================================================================

implementation_notes:
  - "All color mappings should be validated before generation"
  - "Edge case detection should run before syntax inference"
  - "Fallback strategies must be applied consistently"
  - "Generated themes should include source attribution"
  - "Preserve Windows Terminal scheme name in IntelliJ theme metadata"
  - "Log all fallback applications for debugging"
  - "Generate human-readable mapping report for each theme"

# ==============================================================================
# VERSION HISTORY
# ==============================================================================

version_history:
  - version: "1.0"
    date: "2025-11-20"
    changes: "Initial specification for Sprint 1"
    author: "Automated System"
